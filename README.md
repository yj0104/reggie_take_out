## 10月20日敲得代码

### 新增功能
1. 新增套餐
   1. 需求分析:
      - 套餐就是菜品的集合.后台系统中可以管理套餐信息，通过新增套餐功能来添加一个新的套餐，在添加套餐时需要选择当前套餐所属的套餐分类和包含的菜品，并且需要上传套餐对应的图-片，在移动端会按照套餐分类来展示对应的套餐。
   2. 准备工作
      1. 实体类(SetmealDish,SetmealDto),以及相应的Mapper,Service接口及实现.
   3. 功能实现(根据分类查询菜品)
      - 在当前的需求中，我们只需要根据页面传递的菜品分类的ID(categoryId)来查询菜品列表即可，我们可以直接定义一个DishController的方法，声明一个Long类型的categoryId，这样做是没问题的。但是考虑到该方法的拓展性，我们在这里定义方法时，通过Dish这个实体来接收参数。
      - 在DishController中定义方法list，接收Dish类型的参数：
      - 在查询时，需要根据菜品分类categoryId进行查询，并且还要限定菜品的状态为起售状态(status为1)，然后对查询的结果进行排序。
   4. 功能实现(保存套餐)
      - 在进行套餐信息保存时，前端提交的数据，不仅包含套餐的基本信息，还包含套餐关联的菜品列表数据 setmealDishes。所以这个时候我们使用Setmeal就不能完成参数的封装了，我们需要在Setmeal的基本属性的基础上，再扩充一个属性 setmealDishes 来接收页面传递的套餐关联的菜品列表，而我们在准备工作中，导入进来的SetmealDto能够满足这个需求。
      - SetmealController中定义方法save，新增套餐
      - etmealService中定义方法saveWithDish
      - SetmealServiceImpl实现方法saveWithDish
        - 保存套餐基本信息
        - 获取套餐关联的菜品集合，并为集合中的每一个元素赋值套餐ID(setmealId)
        - 批量保存套餐关联的菜品集合
   
2. 套餐管理页面分页查询功能
   - (分析):在进行套餐数据的分页查询时，除了传递分页参数以外，还可以传递一个可选的条件(套餐名称)。查询返回的字段中，包含套餐的基本信息之外，还有一个套餐的分类名称，在查询时，需要关联查询这个字段。
   - 在SetmealController中创建套餐分页查询方法(逻辑)
     - 构建条件分页对象
     - 构建查询条件对象,如果传递了套餐名称,根据套餐名称模糊查询,并对结果按修改时间降序排序
     - 执行分页查询
     - 根据categoryId查出categoryName
     - 组装数据并返回
3. 删除套餐功能(直接写批量删除,注意停售状态)
   1. 在SetmealController中创建delete方法
   2. SetmealService接口定义方法removeWithDish
   3. SetmealServiceImpl中实现方法removeWithDish(具体逻辑为)
      1. 查询该批次套餐中是否存在售卖中的套餐,如果存在,不允许删除
      2. 删除套餐数据
      3. 删除套餐关联的菜品数据
4. 用户登录短信验证功能
   1. 怎么发短信可以查寻阿里云官网
   2. 增加User实体类及相关的Mapper,Service,Controller.(SMSUtils,ValidateCodeUtils)工具类
   3. 在登录状态过滤器里增加过滤路径
   4. 发送验证码,并将验证码存入Session
   5. 在UserController中增加登录的方法 login，该方法的具体逻辑为：
      1. 获取前端传递的手机号和验证码
      2. 从Session中获取到手机号对应的正确的验证码
      3. 进行验证码的对比,如果对对比失败,直接返回错误信息
      4. 如果对比成功,需要根据手机号查询查询当前用户,如果用户不存在,则自动注册一个新用户
      5. 将登录用户的ID存储在Session中